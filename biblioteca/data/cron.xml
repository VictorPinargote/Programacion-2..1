<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- 
            CRON JOB: Verificación Automática de Préstamos Vencidos
            
            Este cron se ejecuta automáticamente para:
            1. Buscar préstamos que superaron la fecha máxima de devolución
            2. Verificar si cumplieron los días de gracia configurados
            3. Generar multas automáticamente
            4. Enviar correos electrónicos de notificación a los lectores
        -->
        <record id="cron_verificar_prestamos_vencidos" model="ir.cron">
            <field name="name">Verificar Préstamos Vencidos y Enviar Notificaciones</field>
            
            <!-- Modelo y método a ejecutar -->
            <field name="model_id" ref="model_biblioteca_prestamo"/>
            <field name="state">code</field>
            <field name="code">model._cron_verificar_prestamos_vencidos()</field>
            
            <!-- 
                FRECUENCIA DE EJECUCIÓN:
                - interval_number: cada cuántas unidades de tiempo
                - interval_type: tipo de intervalo (minutes, hours, days, weeks, months)
                
                Configuración actual: Cada 1 día (se ejecuta diariamente)
                Puedes cambiar a 'hours' para que se ejecute cada X horas
            -->
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            
            <!-- 
                HORA DE EJECUCIÓN:
                nextcall: Primera ejecución y hora del día para ejecuciones diarias
                Formato: YYYY-MM-DD HH:MM:SS
                
                Configuración actual: 08:00 AM (hora del servidor)
                Nota: La hora se ajusta según la zona horaria del servidor
            -->
            <field name="nextcall" eval="(DateTime.now() + timedelta(days=1)).replace(hour=8, minute=0, second=0)"/>
            
            <!-- Configuración de reintentos -->
            <field name="numbercall">-1</field> <!-- -1 = ejecución infinita -->
            <field name="doall" eval="False"/> <!-- No ejecutar trabajos perdidos -->
            
            <!-- Usuario que ejecuta el cron (admin por defecto) -->
            <field name="user_id" ref="base.user_root"/>
            
            <!-- Activar el cron automáticamente al instalar el módulo -->
            <field name="active" eval="True"/>
        </record>
        
    </data>
</odoo>