<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.actions.act_window" id="biblioteca_configuracion_action_window">
        <field name="name">Configuraci√≥n de Multas</field>
        <field name="res_model">biblioteca.configuracion</field>
        <field name="view_mode">form</field>
    </record>

    <!-- Formulario de Configuraci√≥n MEJORADO -->
    <record model="ir.ui.view" id="biblioteca_configuracion_form">
        <field name="name">biblioteca.configuracion.form</field>
        <field name="model">biblioteca.configuracion</field>
        <field name="arch" type="xml">
            <form string="Configuraci√≥n">
                <sheet>
                    <!-- T√≠tulo Principal -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1" class="oe_inline"/>
                        </h1>
                    </div>

                    <!-- Configuraci√≥n General -->
                    <group string="‚öôÔ∏è Configuraci√≥n General del Sistema">
                        <group>
                            <field name="email_biblioteca" 
                                   placeholder="biblioteca@ejemplo.com"
                                   help="Correo desde el cual se enviar√°n las notificaciones"/>
                        </group>
                    </group>

                    <separator string="üìÖ Configuraci√≥n de Pr√©stamos"/>
                    
                    <group>
                        <group>
                            <field name="dias_prestamo" 
                                   help="D√≠as que el usuario tiene para devolver un libro"/>
                        </group>
                        <group>
                            <field name="dias_gracia_notificacion" 
                                   help="D√≠as de espera despu√©s del vencimiento antes de generar multa y enviar correo"/>
                        </group>
                    </group>

                    <!-- Informaci√≥n sobre el cron job -->
                    <group>
                        <div class="alert alert-info" role="alert">
                            <strong>‚ÑπÔ∏è Sistema Autom√°tico de Multas:</strong>
                            <p style="margin-top: 10px;">
                                El sistema verifica autom√°ticamente los pr√©stamos vencidos cada hora 
                                (configurable en Configuraci√≥n ‚Üí Acciones Programadas ‚Üí "Verificar Pr√©stamos Vencidos").
                            </p>
                            <p>
                                Cuando un pr√©stamo supera la fecha m√°xima de devoluci√≥n + d√≠as de gracia:
                            </p>
                            <ul>
                                <li>‚úÖ Se crea autom√°ticamente una multa en la base de datos</li>
                                <li>üìß Se env√≠a un correo al lector notificando la multa</li>
                                <li>üîÑ El pr√©stamo cambia a estado "Con Multa"</li>
                                <li>üìä La multa se actualiza si el retraso aumenta</li>
                            </ul>
                        </div>
                    </group>

                    <separator string="üí∞ Montos de Multas"/>
                    
                    <!-- Multas por Retraso -->
                    <group string="üìÖ Por Retraso en Devoluci√≥n">
                        <field name="monto_multa_dia" 
                               widget="monetary"
                               help="Monto que se cobra por cada d√≠a de retraso"/>
                        <div class="alert alert-success" role="alert" colspan="2">
                            <strong>Ejemplo:</strong> Si el monto es $1.00 y hay 5 d√≠as de retraso, 
                            la multa ser√° de $5.00 (se calcula autom√°ticamente).
                        </div>
                    </group>

                    <!-- Multas por Condici√≥n del Libro -->
                    <group string="üìö Por Condici√≥n del Libro al Devolver">
                        <group>
                            <field name="monto_multa_dano_leve" 
                                   widget="monetary"
                                   help="P√°ginas dobladas, rayones menores, cubiertas rayadas"/>
                            <field name="monto_multa_dano_grave" 
                                   widget="monetary"
                                   help="P√°ginas arrancadas, manchas de l√≠quidos, da√±o estructural"/>
                        </group>
                        <group>
                            <field name="monto_multa_perdida" 
                                   widget="monetary"
                                   help="Cuando el libro se pierde completamente"/>
                        </group>
                    </group>

                    <!-- Informaci√≥n Detallada -->
                    <group>
                        <div class="alert alert-warning" role="alert">
                            <strong>‚ö†Ô∏è Importante - C√≥mo Funciona el Sistema:</strong>
                            <br/><br/>
                            <strong>1. Multas por Retraso (Autom√°ticas):</strong>
                            <ul>
                                <li>Se generan autom√°ticamente cuando el pr√©stamo est√° vencido</li>
                                <li>El sistema verifica cada hora los pr√©stamos vencidos</li>
                                <li>Se cobra $<field name="monto_multa_dia" readonly="1" nolabel="1"/> por d√≠a</li>
                                <li>Se actualiza autom√°ticamente si el retraso aumenta</li>
                                <li>Se env√≠a correo autom√°tico al lector</li>
                            </ul>
                            <br/>
                            <strong>2. Multas por Condici√≥n del Libro (Manuales):</strong>
                            <ul>
                                <li><strong>Buen Estado:</strong> No genera multa adicional</li>
                                <li><strong>Da√±o Leve ($<field name="monto_multa_dano_leve" readonly="1" nolabel="1"/>):</strong> 
                                    P√°ginas dobladas, cubiertas rayadas ‚Üí Libro pasa a "En Reparaci√≥n"</li>
                                <li><strong>Da√±o Grave ($<field name="monto_multa_dano_grave" readonly="1" nolabel="1"/>):</strong> 
                                    P√°ginas arrancadas, l√≠quidos ‚Üí Libro pasa a "No Disponible" y se reduce 1 copia del inventario</li>
                                <li><strong>Perdido ($<field name="monto_multa_perdida" readonly="1" nolabel="1"/>):</strong> 
                                    Libro perdido ‚Üí Libro pasa a "No Disponible" y se reduce 1 copia del inventario</li>
                            </ul>
                            <br/>
                            <strong>3. Multas Combinadas:</strong>
                            <p style="margin-top: 5px;">
                                Si un libro se devuelve tarde Y con da√±os, ambas multas se suman autom√°ticamente:
                            </p>
                            <p style="background-color: #fff3cd; padding: 10px; border-radius: 3px; margin-top: 5px;">
                                <strong>Ejemplo:</strong> Libro devuelto 3 d√≠as tarde con da√±o leve:<br/>
                                ‚Ä¢ Multa por retraso: 3 d√≠as √ó $<field name="monto_multa_dia" readonly="1" nolabel="1"/> = $<span class="oe_inline"><field name="monto_multa_dia" readonly="1" nolabel="1" invisible="1"/></span><br/>
                                ‚Ä¢ Multa por da√±o leve: $<field name="monto_multa_dano_leve" readonly="1" nolabel="1"/><br/>
                                ‚Ä¢ <strong>Total: Se suman ambas multas</strong>
                            </p>
                        </div>
                    </group>

                    <!-- Notas Finales -->
                    <group>
                        <div class="alert alert-info" role="alert">
                            <strong>üìå Notas Importantes:</strong>
                            <ul>
                                <li>Las multas autom√°ticas se crean en la secci√≥n "Multas" del men√∫</li>
                                <li>Los correos se env√≠an autom√°ticamente usando el servidor de correo configurado</li>
                                <li>Para verificar el estado del cron job, vaya a: 
                                    <br/><em>Configuraci√≥n ‚Üí T√©cnico ‚Üí Automatizaci√≥n ‚Üí Acciones Programadas</em></li>
                                <li>Puede ejecutar manualmente el cron desde la lista de acciones programadas</li>
                            </ul>
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <menuitem name="Configuraci√≥n" 
              id="biblioteca.menu_configuracion" 
              parent="biblioteca_menu" 
              action="biblioteca_configuracion_action_window" 
              sequence="100"/>
</odoo>