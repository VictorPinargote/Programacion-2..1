<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.actions.act_window" id="biblioteca_configuracion_action_window">
        <field name="name">Configuraci√≥n de Multas</field>
        <field name="res_model">biblioteca.configuracion</field>
        <field name="view_mode">form</field>
    </record>

    <!-- Formulario de Configuraci√≥n -->
    <record model="ir.ui.view" id="biblioteca_configuracion_form">
        <field name="name">biblioteca.configuracion.form</field>
        <field name="model">biblioteca.configuracion</field>
        <field name="arch" type="xml">
            <form string="Configuraci√≥n">
                <sheet>
                    <!-- T√≠tulo Principal -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1" class="oe_inline"/>
                        </h1>
                    </div>

                    <!-- Alerta de permisos -->
                    <div class="alert alert-warning" role="alert" groups="biblioteca.group_biblioteca_usuario">
                        <strong>‚ö†Ô∏è Solo Lectura:</strong> Solo los administradores pueden modificar esta configuraci√≥n.
                    </div>

                    <!-- Configuraci√≥n General -->
                    <group string="‚öôÔ∏è Configuraci√≥n General del Sistema">
                        <group>
                            <field name="email_biblioteca" 
                                   placeholder="biblioteca@ejemplo.com"
                                   help="Correo desde el cual se enviar√°n las notificaciones"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="email_biblioteca" 
                                   placeholder="biblioteca@ejemplo.com"
                                   help="Correo desde el cual se enviar√°n las notificaciones"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                        </group>
                    </group>

                    <separator string="üìÖ Configuraci√≥n de Pr√©stamos"/>
                    
                    <group>
                        <group>
                            <field name="dias_prestamo" 
                                   help="D√≠as que el usuario tiene para devolver un libro"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="dias_prestamo" 
                                   help="D√≠as que el usuario tiene para devolver un libro"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                        </group>
                        <group>
                            <field name="dias_gracia_notificacion" 
                                   help="D√≠as de espera despu√©s del vencimiento antes de generar multa y enviar correo"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="dias_gracia_notificacion" 
                                   help="D√≠as de espera despu√©s del vencimiento antes de generar multa y enviar correo"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                        </group>
                    </group>

                    <!-- Informaci√≥n sobre el cron job -->
                    <group>
                        <div class="alert alert-info" role="alert">
                            <strong>‚ÑπÔ∏è Sistema Autom√°tico de Multas:</strong>
                            <p style="margin-top: 10px;">
                                El sistema verifica autom√°ticamente los pr√©stamos vencidos cada hora 
                                (configurable en Configuraci√≥n ‚Üí Acciones Programadas ‚Üí "Verificar Pr√©stamos Vencidos").
                            </p>
                            <p>
                                Cuando un pr√©stamo supera la fecha m√°xima de devoluci√≥n + d√≠as de gracia:
                            </p>
                            <ul>
                                <li>‚úÖ Se crea autom√°ticamente una multa en la base de datos</li>
                                <li>üìß Se env√≠a un correo al lector notificando la multa</li>
                                <li>üîÑ El pr√©stamo cambia a estado "Con Multa"</li>
                                <li>üìä La multa se actualiza si el retraso aumenta</li>
                            </ul>
                        </div>
                    </group>

                    <separator string="üí∞ Montos de Multas"/>
                    
                    <!-- Multas por Retraso -->
                    <group string="üìÖ Por Retraso en Devoluci√≥n">
                        <field name="monto_multa_dia" 
                               widget="monetary"
                               help="Monto que se cobra por cada d√≠a de retraso"
                               groups="biblioteca.group_biblioteca_administrador"/>
                        <field name="monto_multa_dia" 
                               widget="monetary"
                               help="Monto que se cobra por cada d√≠a de retraso"
                               groups="biblioteca.group_biblioteca_usuario"
                               readonly="1"/>
                        <div class="alert alert-success" role="alert" colspan="2">
                            <strong>Ejemplo:</strong> Si el monto es $1.00 y hay 5 d√≠as de retraso, 
                            la multa ser√° de $5.00 (se calcula autom√°ticamente).
                        </div>
                    </group>

                    <!-- Multas por Condici√≥n del Libro -->
                    <group string="üìö Por Condici√≥n del Libro al Devolver">
                        <group>
                            <field name="monto_multa_dano_leve" 
                                   widget="monetary"
                                   help="P√°ginas dobladas, rayones menores, cubiertas rayadas"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="monto_multa_dano_leve" 
                                   widget="monetary"
                                   help="P√°ginas dobladas, rayones menores, cubiertas rayadas"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                            <field name="monto_multa_dano_grave" 
                                   widget="monetary"
                                   help="P√°ginas arrancadas, manchas de l√≠quidos, da√±o estructural"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="monto_multa_dano_grave" 
                                   widget="monetary"
                                   help="P√°ginas arrancadas, manchas de l√≠quidos, da√±o estructural"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                        </group>
                        <group>
                            <field name="monto_multa_perdida" 
                                   widget="monetary"
                                   help="Cuando el libro se pierde completamente"
                                   groups="biblioteca.group_biblioteca_administrador"/>
                            <field name="monto_multa_perdida" 
                                   widget="monetary"
                                   help="Cuando el libro se pierde completamente"
                                   groups="biblioteca.group_biblioteca_usuario"
                                   readonly="1"/>
                        </group>
                    </group>

                    <!-- Informaci√≥n Detallada -->
                    <group>
                        <div class="alert alert-warning" role="alert">
                            <strong>‚ö†Ô∏è Importante - C√≥mo Funciona el Sistema:</strong>
                            <br/><br/>
                            <strong>1. Multas por Retraso (Autom√°ticas):</strong>
                            <ul>
                                <li>Se generan autom√°ticamente cuando el pr√©stamo est√° vencido</li>
                                <li>El sistema verifica cada hora los pr√©stamos vencidos</li>
                                <li>Se cobra por d√≠a seg√∫n configuraci√≥n</li>
                                <li>Se actualiza autom√°ticamente si el retraso aumenta</li>
                                <li>Se env√≠a correo autom√°tico al lector</li>
                            </ul>
                            <br/>
                            <strong>2. Multas por Condici√≥n del Libro (Manuales):</strong>
                            <ul>
                                <li><strong>Buen Estado:</strong> No genera multa adicional</li>
                                <li><strong>Da√±o Leve:</strong> P√°ginas dobladas, cubiertas rayadas</li>
                                <li><strong>Da√±o Grave:</strong> P√°ginas arrancadas, l√≠quidos ‚Üí Se reduce 1 copia del inventario</li>
                                <li><strong>Perdido:</strong> Libro perdido ‚Üí Se reduce 1 copia del inventario</li>
                            </ul>
                            <br/>
                            <strong>3. Multas Combinadas:</strong>
                            <p style="margin-top: 5px;">
                                Si un libro se devuelve tarde Y con da√±os, ambas multas se suman autom√°ticamente.
                            </p>
                        </div>
                    </group>

                    <!-- Informaci√≥n sobre permisos -->
                    <group groups="biblioteca.group_biblioteca_administrador">
                        <div class="alert alert-success" role="alert">
                            <strong>üîê Permisos de Administrador:</strong>
                            <p style="margin-top: 10px;">
                                Como administrador, tienes acceso completo al sistema:
                            </p>
                            <ul>
                                <li>‚úÖ Modificar toda la configuraci√≥n de multas</li>
                                <li>‚úÖ Gestionar pr√©stamos y devoluciones</li>
                                <li>‚úÖ Crear nuevos usuarios del sistema</li>
                                <li>‚úÖ Acceder al cron job de verificaci√≥n</li>
                                <li>‚úÖ Ver todos los pr√©stamos y multas del sistema</li>
                            </ul>
                        </div>
                    </group>

                    <!-- Notas Finales -->
                    <group>
                        <div class="alert alert-info" role="alert">
                            <strong>üìå Notas Importantes:</strong>
                            <ul>
                                <li>Las multas autom√°ticas se crean en la secci√≥n "Multas" del men√∫</li>
                                <li>Los correos se env√≠an autom√°ticamente usando el servidor de correo configurado</li>
                                <li groups="biblioteca.group_biblioteca_administrador">Para verificar el estado del cron job, vaya a: 
                                    <br/><em>Configuraci√≥n ‚Üí T√©cnico ‚Üí Automatizaci√≥n ‚Üí Acciones Programadas</em></li>
                                <li groups="biblioteca.group_biblioteca_administrador">Puede ejecutar manualmente el cron desde la lista de acciones programadas</li>
                                <li groups="biblioteca.group_biblioteca_usuario">Si tiene dudas sobre la configuraci√≥n, consulte con un administrador</li>
                            </ul>
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <menuitem name="Configuraci√≥n" 
              id="biblioteca.menu_configuracion" 
              parent="biblioteca_menu" 
              action="biblioteca_configuracion_action_window" 
              sequence="100"/>
</odoo>