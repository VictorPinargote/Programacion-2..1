<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================================ -->
    <!-- CAMBIO: Template de Email - ACTUALIZADO CON TIPOS DE MULTA Y ESTADO DEL LIBRO -->
    <!-- ============================================================ -->
    <record id="email_template_notificacion_multa" model="mail.template">
        <field name="name">Notificaci√≥n de Multa por Retraso</field>
        <field name="model_id" ref="model_biblioteca_prestamo"/>
        <field name="subject">Notificaci√≥n de Multa - Pr√©stamo ${object.name}</field>
        <field name="email_from">${(object.company_id.email or 'biblioteca@ejemplo.com')|safe}</field>
        <field name="email_to">${object.email_lector|safe}</field>
        <field name="body_html"><![CDATA[
<div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f5f5f5;">
    
    <!-- Header -->
    <div style="background-color: #d9534f; color: white; padding: 20px; border-radius: 5px 5px 0 0;">
        <h2 style="margin: 0;">‚ö†Ô∏è Notificaci√≥n de Multa</h2>
        <p style="margin: 5px 0 0 0; font-size: 14px;">Sistema de Biblioteca</p>
    </div>
    
    <!-- Body -->
    <div style="background-color: white; padding: 20px; border-radius: 0 0 5px 5px;">
        <p>Estimado(a) <strong>${object.usuario_id.name}</strong>,</p>
        
        <p>Le informamos que el libro <strong>"${object.libro_id.titulo}"</strong> ha generado una multa.</p>
        
        <!-- NUEVO: Detalles del Pr√©stamo -->
        <div style="background-color: #f8f9fa; padding: 15px; border-left: 4px solid #0066cc; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #0066cc;">üìö Detalles del Pr√©stamo</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="padding: 5px 0;"><strong>C√≥digo:</strong></td>
                    <td style="padding: 5px 0;">${object.name}</td>
                </tr>
                <tr>
                    <td style="padding: 5px 0;"><strong>Libro:</strong></td>
                    <td style="padding: 5px 0;">${object.libro_id.titulo}</td>
                </tr>
                <tr>
                    <td style="padding: 5px 0;"><strong>Fecha de pr√©stamo:</strong></td>
                    <td style="padding: 5px 0;">${object.fecha_prestamo.strftime('%d/%m/%Y') if object.fecha_prestamo else 'N/A'}</td>
                </tr>
                <tr>
                    <td style="padding: 5px 0;"><strong>Fecha m√°xima:</strong></td>
                    <td style="padding: 5px 0;">${object.fecha_maxima.strftime('%d/%m/%Y') if object.fecha_maxima else 'N/A'}</td>
                </tr>
            </table>
        </div>
        
        <!-- NUEVO: Detalles de la Multa con colores seg√∫n tipo -->
        <div style="background-color: #f8d7da; padding: 15px; border-left: 4px solid #d9534f; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #d9534f;">üí∞ Detalles de la Multa</h3>
            
            <!-- Mostrar d√≠as de retraso si existen -->
            % if object.dias_retraso > 0:
            <div style="background-color: #fff3cd; padding: 10px; border-radius: 3px; margin: 10px 0;">
                <p style="margin: 0;">
                    <strong>‚è∞ D√≠as de retraso:</strong> ${object.dias_retraso} d√≠a(s)
                </p>
            </div>
            % endif
            
            <!-- NUEVO: Mostrar condici√≥n del libro si fue devuelto con da√±o -->
            % if object.condicion_devolucion and object.condicion_devolucion != 'bueno':
            <div style="background-color: #f8d7da; padding: 10px; border-radius: 3px; margin: 10px 0;">
                <p style="margin: 0;">
                    <strong>üìñ Condici√≥n del libro:</strong> 
                    % if object.condicion_devolucion == 'dano_leve':
                        Da√±o Leve
                    % elif object.condicion_devolucion == 'dano_grave':
                        Da√±o Grave
                    % elif object.condicion_devolucion == 'perdido':
                        Perdido
                    % endif
                </p>
                % if object.notas_devolucion:
                <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;">
                    <em>Nota: ${object.notas_devolucion}</em>
                </p>
                % endif
            </div>
            % endif
            
            <!-- Monto total de la multa -->
            <div style="background-color: white; padding: 15px; border-radius: 3px; margin: 15px 0; text-align: center; border: 2px solid #d9534f;">
                <p style="margin: 0; font-size: 16px; color: #666;">Monto Total a Pagar</p>
                <p style="margin: 10px 0 0 0; font-size: 32px; color: #d9534f; font-weight: bold;">
                    $${object.multa}
                </p>
            </div>
        </div>
        
        <!-- NUEVO: Estado del Libro -->
        % if object.libro_id.estado_libro:
        <div style="background-color: #d1ecf1; padding: 15px; border-left: 4px solid #0c5460; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #0c5460;">üìä Estado Actual del Libro</h3>
            <p style="margin: 0;">
                El libro ha sido marcado como: 
                <strong>
                    % if object.libro_id.estado_libro == 'disponible':
                        Disponible ‚úÖ
                    % elif object.libro_id.estado_libro == 'en_reparacion':
                        En Reparaci√≥n üîß
                    % elif object.libro_id.estado_libro == 'no_disponible':
                        No Disponible ‚ùå
                    % elif object.libro_id.estado_libro == 'prestado':
                        Prestado üì§
                    % endif
                </strong>
            </p>
        </div>
        % endif
        
        <!-- Instrucciones de pago -->
        <div style="background-color: #d4edda; padding: 15px; border-left: 4px solid #28a745; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #28a745;">üí≥ ¬øC√≥mo pagar?</h3>
            <ol style="margin: 0; padding-left: 20px;">
                <li>Ac√©rquese a la biblioteca</li>
                <li>Presente su c√©dula y el c√≥digo del pr√©stamo: <strong>${object.name}</strong></li>
                <li>Realice el pago de la multa</li>
                <li>Obtenga su comprobante</li>
            </ol>
        </div>
        
        <!-- Mensaje de cierre -->
        <p style="margin-top: 20px;">
            Por favor, regularice su situaci√≥n a la brevedad posible para poder realizar nuevos pr√©stamos.
        </p>
        
        <p style="margin-top: 20px;">
            Gracias por su comprensi√≥n,<br/>
            <strong>Equipo de Biblioteca</strong>
        </p>
    </div>
    
    <!-- Footer -->
    <div style="text-align: center; padding: 15px; color: #666; font-size: 12px;">
        <p style="margin: 0;">Este es un mensaje autom√°tico. Por favor no responda a este correo.</p>
        <p style="margin: 5px 0 0 0;">
            Para m√°s informaci√≥n, cont√°ctenos a: 
            <a href="mailto:biblioteca@ejemplo.com" style="color: #0066cc;">biblioteca@ejemplo.com</a>
        </p>
    </div>
    
</div>
        ]]></field>
    </record>

    <!-- ============================================================ -->
    <!-- NUEVO: Template para Recordatorio de Libro Pr√≥ximo a Vencer -->
    <!-- ============================================================ -->
    <record id="email_template_recordatorio_vencimiento" model="mail.template">
        <field name="name">Recordatorio de Vencimiento de Pr√©stamo</field>
        <field name="model_id" ref="model_biblioteca_prestamo"/>
        <field name="subject">Recordatorio: Devoluci√≥n de "${object.libro_id.titulo}"</field>
        <field name="email_from">${(object.company_id.email or 'biblioteca@ejemplo.com')|safe}</field>
        <field name="email_to">${object.email_lector|safe}</field>
        <field name="body_html"><![CDATA[
<div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f5f5f5;">
    
    <!-- Header -->
    <div style="background-color: #ffc107; color: white; padding: 20px; border-radius: 5px 5px 0 0;">
        <h2 style="margin: 0;">üîî Recordatorio de Devoluci√≥n</h2>
    </div>
    
    <!-- Body -->
    <div style="background-color: white; padding: 20px; border-radius: 0 0 5px 5px;">
        <p>Estimado(a) <strong>${object.usuario_id.name}</strong>,</p>
        
        <p>Le recordamos que tiene un libro pendiente de devoluci√≥n:</p>
        
        <div style="background-color: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0;">
            <h3 style="margin-top: 0;">üìö "${object.libro_id.titulo}"</h3>
            <p><strong>Fecha m√°xima de devoluci√≥n:</strong> ${object.fecha_maxima.strftime('%d/%m/%Y %H:%M') if object.fecha_maxima else 'N/A'}</p>
        </div>
        
        <div style="background-color: #d1ecf1; padding: 15px; border-radius: 5px; margin: 20px 0;">
            <p style="margin: 0;"><strong>üí° Importante:</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>Devuelva el libro a tiempo para evitar multas</li>
                <li>Verifique que el libro est√© en buen estado</li>
                <li>Si el libro presenta da√±os, informe al personal</li>
            </ul>
        </div>
        
        <p>¬°Gracias por su responsabilidad!</p>
    </div>
    
    <div style="text-align: center; padding: 15px; color: #666; font-size: 12px;">
        <p style="margin: 0;">Este es un mensaje autom√°tico.</p>
    </div>
    
</div>
        ]]></field>
    </record>
</odoo>