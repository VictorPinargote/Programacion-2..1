<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        
        <!-- ============================================================ -->
        <!-- CATEGORÍA PRINCIPAL -->
        <!-- ============================================================ -->
        <record id="module_category_biblioteca" model="ir.module.category">
            <field name="name">Biblioteca</field>
            <field name="description">Gestión de Biblioteca - Sistema de Préstamos</field>
            <field name="sequence">10</field>
        </record>

        <!-- ============================================================ -->
        <!-- GRUPO: USUARIO NORMAL (Solo lectura) -->
        <!-- ============================================================ -->
        <record id="group_biblioteca_usuario" model="res.groups">
            <field name="name">Usuario Normal</field>
            <field name="category_id" ref="module_category_biblioteca"/>
            <field name="comment">
                Usuario normal de biblioteca. 
                Permisos: Solo puede VER libros, autores, editoriales.
                NO puede crear préstamos ni modificar configuración.
            </field>
        </record>

        <!-- ============================================================ -->
        <!-- GRUPO: ADMINISTRADOR (Control total) -->
        <!-- ============================================================ -->
        <record id="group_biblioteca_administrador" model="res.groups">
            <field name="name">Administrador de Biblioteca</field>
            <field name="category_id" ref="module_category_biblioteca"/>
            <field name="implied_ids" eval="[(4, ref('group_biblioteca_usuario'))]"/>
            <field name="comment">
                Administrador de biblioteca.
                Permisos: Control total del sistema.
                Puede crear préstamos, gestionar multas, configurar sistema.
            </field>
        </record>

        <!-- ============================================================ -->
        <!-- REGLA DE ACCESO: Los usuarios solo ven sus propios préstamos -->
        <!-- Los administradores ven TODO -->
        <!-- ============================================================ -->
        <record id="prestamo_rule_usuario_normal" model="ir.rule">
            <field name="name">Usuario Normal: Solo sus préstamos</field>
            <field name="model_id" ref="model_biblioteca_prestamo"/>
            <field name="domain_force">[('usuario_id.create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_biblioteca_usuario'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="prestamo_rule_administrador" model="ir.rule">
            <field name="name">Administrador: Ver todos los préstamos</field>
            <field name="model_id" ref="model_biblioteca_prestamo"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_biblioteca_administrador'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ============================================================ -->
        <!-- REGLA: Usuarios normales solo ven sus propias multas -->
        <!-- ============================================================ -->
        <record id="multa_rule_usuario_normal" model="ir.rule">
            <field name="name">Usuario Normal: Solo sus multas</field>
            <field name="model_id" ref="model_biblioteca_multa"/>
            <field name="domain_force">[('usuario_id.create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_biblioteca_usuario'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="multa_rule_administrador" model="ir.rule">
            <field name="name">Administrador: Ver todas las multas</field>
            <field name="model_id" ref="model_biblioteca_multa"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_biblioteca_administrador'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Asignar automáticamente el admin como administrador de biblioteca -->
        <record id="user_admin_biblioteca" model="res.users">
            <field name="id" ref="base.user_admin"/>
            <field name="groups_id" eval="[(4, ref('group_biblioteca_administrador'))]"/>
        </record>
    </data>
</odoo>